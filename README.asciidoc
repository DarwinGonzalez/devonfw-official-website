:toc: right

# Next version of devonfw website

image:https://travis-ci.com/devonfw/devonfw-official-website.svg?branch=master[link="https://travis-ci.com/devonfw/devonfw-official-website"] 

## Dependencies

* http://de-mucevolve02/files/devonfw/current/[devonfw distribution]

## Initial setup

* Open the console in your devonfw distribution (console.bat).
* Clone this project `git clone --recurse-submodules https://github.com/devonfw/devonfw-official-website.git`.
* Inside _/devonfw-official-website/search-engine/_ run `npm install`.

Once all the steps are done, go back to _/devonfw-official-website/_ and then:

```bash
mvn clean package -Ddocgen.images.dir=images,documentation -Doutput.format=html
```

After completing the last step:

Option 1:

* Install http-server from npm: `npm install -g http-server`
* run `http-server target/generated-docs/ -o`. The default port used will be 8080 but a different one can be specified using the argument `-p port-number`.

Option 2:

* run `python -m http.server -d target/generated-docs/  port-number`.


Now you will be able to go to http://localhost:port-number/index.html.

## During development

### Configuration changes
The file `website/config/devonfw-site-conf.js` stores variables for multiple configurations, here are the two most relevant:

* *BASE_PATH*: const BASE_PATH = '/devonfw-official-website/';

Due to the fact that the website is deployed to https://www.devonfw.com/devonfw-official-website/index.html, the base path is set to *'/devonfw-official-website/'*. If you are serving the website on your local machine localhost:port/index.html the path must be set to *'/'* 

* *editSrc.searchValue*:

The tool devon-docgen used to generate the html uses the absolute path of the compiling machine as the source of the images, so when it is deployed, this url is wrong.

```
Failed to load resource: the server responded with a status of 404 ()
```

To overcome this problem, *editSrc.searchValue* contains a string that is replaced to *editSrc.imgFolderPath*'s value.

The current value of editSrc.searchValue is `/home/travis/build/devonfw/devonfw-official-website/target/generated-docs/`, but it must be replaced to the absolute path in your machine, usually something like `C:/projects/devonfw-official-website/target/generated-docs/`.


## devonfw official website process

image::https://raw.githubusercontent.com/devonfw/devonfw-official-website/master/documentation/devonfw-official-website-proc.png[float="right"]

If you want to edit this image you can go to https://www.draw.io/[draw.io] and open the file documentation/devonfw-official-website-proc.drawio

1. Asciidoc files hosted on github. https://github.com/devonfw/devonfw-guide[devonfw-guide]

2. Cloning the project in a machine:

```bash

git clone --recurse-submodules https://github.com/devonfw/devonfw-official-website.git

```

3. Maven is used to convert the cloned .asciidoc files into .html ones.

```bash

mvn clean package -Ddocgen.images.dir=images,documentation -Doutput.format=html

```
  

4. devonfw website uses a search engine called https://lunrjs.com/[lunr], which takes documents to build an index. The index generated by lunr is used to perform searches given a query.

To generate the index run:

  

```bash

cd search-engine

npm install

cd ../devonfw-guide

node ../search-engine/converter.js ./ .html

cp ./index.json ../website/index.json

cp ./docs-json ../website/docs-json.json

cd ..

```


5. Once generated all the necessary documents, the results can be displayed on a local machine or deployed to an url.
  * Option 1 (local machine):
  Open the file _target/generated-docs/website/config/devonfw-site-conf.js_ and modify the value of the variables _BASE_PATH_ and _edirSrc.searchValue_.
  
    * set `BASE_PATH = '/'`
    * set `editSrc.searchValue = 'your-absolute-path/target/generated-docs/'`

    To start a local server, you can either run:
    * Option 1.1: `python -m http.server -d target/generated-docs/ port` or
    * Option 1.2: `http-server target/generated-docs/ -p port` (requires npm http-server package installation `npm install -g http-server`)

* Option 2 (deploy):
The changes made on https://github.com/devonfw/devonfw-official-website[devonfw-official-website] will automatically go through a travis process that executes the steps 1 to 4 and then deploys the application.

6. After running the server, you can go to localhost:port/index.html (option 1) or https://www.devonfw.com/devonfw-official-website/index.html (option 2) to see the website.

